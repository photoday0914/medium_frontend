{"remainingRequest":"C:\\Users\\GreatHope\\Documents\\deploy\\frontend\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\GreatHope\\Documents\\deploy\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\GreatHope\\Documents\\deploy\\frontend\\node_modules\\eslint-loader\\index.js??ref--14-0!C:\\Users\\GreatHope\\Documents\\deploy\\frontend\\src\\service\\axios.js","dependencies":[{"path":"C:\\Users\\GreatHope\\Documents\\deploy\\frontend\\src\\service\\axios.js","mtime":1646453247572},{"path":"C:\\Users\\GreatHope\\Documents\\deploy\\frontend\\babel.config.js","mtime":1646361081287},{"path":"C:\\Users\\GreatHope\\Documents\\deploy\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1643426027151},{"path":"C:\\Users\\GreatHope\\Documents\\deploy\\frontend\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1643426027151},{"path":"C:\\Users\\GreatHope\\Documents\\deploy\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1643426032229},{"path":"C:\\Users\\GreatHope\\Documents\\deploy\\frontend\\node_modules\\eslint-loader\\index.js","mtime":1643426028315}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkM6XFxVc2Vyc1xcR3JlYXRIb3BlXFxEb2N1bWVudHNcXGRlcGxveVxcZnJvbnRlbmRcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lXFxoZWxwZXJzXFxlc21cXGFzeW5jVG9HZW5lcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnOwppbXBvcnQgVnVlQ29va2llcyBmcm9tICd2dWUtY29va2llcyc7CmltcG9ydCBzdG9yZSBmcm9tICcuLi9zdG9yZSc7CmltcG9ydCByb3V0ZXIgZnJvbSAnLi4vcm91dGVyJzsKaW1wb3J0IGNvbmZpZyBmcm9tICcuLi9jb25maWcvY29uZmlnJzsKYXhpb3MuZGVmYXVsdHMuYmFzZVVSTCA9IGNvbmZpZy5iYXNlVXJsOyAvLyBjb25zdCBpbnN0YW5jZSA9IGF4aW9zLmNyZWF0ZSh7Ci8vICAgYmFzZVVSTDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCcsCi8vICAgdGltZW91dDogMTAwMAovLyB9KTsKLy8gQWRkIGEgcmVxdWVzdCBpbnRlcmNlcHRvcgoKYXhpb3MuaW50ZXJjZXB0b3JzLnJlcXVlc3QudXNlKCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKGNvbmZpZykgewogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAvLyBEbyBzb21ldGhpbmcgYmVmb3JlIHJlcXVlc3QgaXMgc2VudAogICAgICAgICAgICBjb25maWcuaGVhZGVyc1sieC1hY2Nlc3MtdG9rZW4iXSA9IFZ1ZUNvb2tpZXMuZ2V0KCd0b2tlbicpOyAvLyBjb25maWcuaGVhZGVycy5yZWZyZXNoX3Rva2VuID0gVnVlQ29va2llcy5nZXQoJ3JlZnJlc2hfdG9rZW4nKTsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coY29uZmlnKTsKCiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGNvbmZpZyk7CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIChfeCkgewogICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCksIGZ1bmN0aW9uIChlcnJvcikgewogIC8vIERvIHNvbWV0aGluZyB3aXRoIHJlcXVlc3QgZXJyb3IKICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwp9KTsgLy8gQWRkIGEgcmVzcG9uc2UgaW50ZXJjZXB0b3IKCmF4aW9zLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UoZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgLy8gQW55IHN0YXR1cyBjb2RlIHRoYXQgbGllIHdpdGhpbiB0aGUgcmFuZ2Ugb2YgMnh4IGNhdXNlIHRoaXMgZnVuY3Rpb24gdG8gdHJpZ2dlcgogIC8vIERvIHNvbWV0aGluZyB3aXRoIHJlc3BvbnNlIGRhdGEKICByZXR1cm4gcmVzcG9uc2U7Cn0sIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWYyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihlcnIpIHsKICAgIHZhciBvcmlnaW5hbENvbmZpZywgcmVzLCB0b2tlbjsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIC8vIEFueSBzdGF0dXMgY29kZXMgdGhhdCBmYWxscyBvdXRzaWRlIHRoZSByYW5nZSBvZiAyeHggY2F1c2UgdGhpcyBmdW5jdGlvbiB0byB0cmlnZ2VyCiAgICAgICAgICAgIC8vIERvIHNvbWV0aGluZyB3aXRoIHJlc3BvbnNlIGVycm9yCiAgICAgICAgICAgIG9yaWdpbmFsQ29uZmlnID0gZXJyLmNvbmZpZzsKCiAgICAgICAgICAgIGlmICghKG9yaWdpbmFsQ29uZmlnLnVybCAhPT0gIi9hcGkvYXV0aC9zaWduaW4iICYmIGVyci5yZXNwb25zZSkpIHsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE0OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZXJyLnJlc3BvbnNlLnN0YXR1cyA9PSA0MDMpIHsKICAgICAgICAgICAgICBzdG9yZS5kaXNwYXRjaCgicmVtb3ZlVG9rZW4iKTsKICAgICAgICAgICAgICByb3V0ZXIucHVzaCgnL2xvZ2luJyk7CiAgICAgICAgICAgIH0gLy8gQWNjZXNzIFRva2VuIHdhcyBleHBpcmVkCgoKICAgICAgICAgICAgaWYgKCEoZXJyLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxICYmICFvcmlnaW5hbENvbmZpZy5yZXRyeSkpIHsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE0OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBvcmlnaW5hbENvbmZpZy5yZXRyeSA9IHRydWU7IC8vIHRyeSB7CgogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDc7CiAgICAgICAgICAgIHJldHVybiBheGlvcy5wb3N0KCIvYXBpL2F1dGgvcmVmcmVzaHRva2VuIiwgewogICAgICAgICAgICAgIHJlZnJlc2hUb2tlbjogc3RvcmUuZ2V0dGVycy5nZXRSZWZyZXNoVG9rZW4KICAgICAgICAgICAgfSk7CgogICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICByZXMgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgLy8gLnRoZW4oYXN5bmMgKHJlcykgPT4gewogICAgICAgICAgICAvLyBjb25zdCB7IGFjY2Vzc1Rva2VuIH0gPSByZXMuZGF0YTsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzKTsKICAgICAgICAgICAgdG9rZW4gPSB7CiAgICAgICAgICAgICAgdG9rZW46IHJlcy5kYXRhLmFjY2Vzc1Rva2VuLAogICAgICAgICAgICAgIHJlZnJlc2hUb2tlbjogcmVzLmRhdGEucmVmcmVzaFRva2VuCiAgICAgICAgICAgIH07IC8vIC8vIGNvbnNvbGUubG9nKG9yaWdpbmFsQ29uZmlnKTsKICAgICAgICAgICAgLy9zZXQgdG9rZW4gaW5mbyBpbiBWdWVjb29raWVzCgogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDExOwogICAgICAgICAgICByZXR1cm4gc3RvcmUuZGlzcGF0Y2goJ3NldFRva2VuJywgdG9rZW4pOwoKICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTM7CiAgICAgICAgICAgIHJldHVybiBheGlvcyhvcmlnaW5hbENvbmZpZyk7CgogICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0Mi5zZW50KTsKCiAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgUHJvbWlzZS5yZWplY3QoZXJyKSk7CgogICAgICAgICAgY2FzZSAxNToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTIpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIChfeDIpIHsKICAgIHJldHVybiBfcmVmMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKSk7CmV4cG9ydCBkZWZhdWx0IGF4aW9zOw=="},{"version":3,"sources":["C:/Users/GreatHope/Documents/deploy/frontend/src/service/axios.js"],"names":["axios","VueCookies","store","router","config","defaults","baseURL","baseUrl","interceptors","request","use","headers","get","error","Promise","reject","response","err","originalConfig","url","status","dispatch","push","retry","post","refreshToken","getters","getRefreshToken","res","token","data","accessToken"],"mappings":";;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,UAAP,MAAuB,aAAvB;AACA,OAAOC,KAAP,MAAkB,UAAlB;AACA,OAAOC,MAAP,MAAmB,WAAnB;AACA,OAAOC,MAAP,MAAmB,kBAAnB;AAGAJ,KAAK,CAACK,QAAN,CAAeC,OAAf,GAAyBF,MAAM,CAACG,OAAhC,C,CAEA;AACA;AACA;AACA;AAEA;;AACAP,KAAK,CAACQ,YAAN,CAAmBC,OAAnB,CAA2BC,GAA3B;AAAA,qEAA+B,iBAAgBN,MAAhB;AAAA;AAAA;AAAA;AAAA;AAC3B;AACAA,YAAAA,MAAM,CAACO,OAAP,CAAe,gBAAf,IAAmCV,UAAU,CAACW,GAAX,CAAe,OAAf,CAAnC,CAF2B,CAG3B;AAEA;;AAL2B,6CAMpBR,MANoB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAA/B;;AAAA;AAAA;AAAA;AAAA,KAOK,UAAUS,KAAV,EAAiB;AAClB;AACA,SAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACD,CAVH,E,CAYA;;AACAb,KAAK,CAACQ,YAAN,CAAmBQ,QAAnB,CAA4BN,GAA5B,CAAgC,UAAUM,QAAV,EAAoB;AAChD;AACA;AACA,SAAOA,QAAP;AACD,CAJH;AAAA,sEAIK,kBAAgBC,GAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AACD;AACA;AAEMC,YAAAA,cAJL,GAIsBD,GAAG,CAACb,MAJ1B;;AAAA,kBAKGc,cAAc,CAACC,GAAf,KAAuB,kBAAvB,IAA6CF,GAAG,CAACD,QALpD;AAAA;AAAA;AAAA;;AAMC,gBAAIC,GAAG,CAACD,QAAJ,CAAaI,MAAb,IAAuB,GAA3B,EAAgC;AAC9BlB,cAAAA,KAAK,CAACmB,QAAN,CAAe,aAAf;AACAlB,cAAAA,MAAM,CAACmB,IAAP,CAAY,QAAZ;AACD,aATF,CAUC;;;AAVD,kBAWKL,GAAG,CAACD,QAAJ,CAAaI,MAAb,KAAwB,GAAxB,IAA+B,CAACF,cAAc,CAACK,KAXpD;AAAA;AAAA;AAAA;;AAYGL,YAAAA,cAAc,CAACK,KAAf,GAAuB,IAAvB,CAZH,CAcG;;AAdH;AAAA,mBAeqBvB,KAAK,CAACwB,IAAN,CAAW,wBAAX,EAAqC;AACnDC,cAAAA,YAAY,EAAEvB,KAAK,CAACwB,OAAN,CAAcC;AADuB,aAArC,CAfrB;;AAAA;AAeSC,YAAAA,GAfT;AAmBK;AACE;AACA;AACMC,YAAAA,KAtBb,GAsBqB;AACZA,cAAAA,KAAK,EAAED,GAAG,CAACE,IAAJ,CAASC,WADJ;AAEZN,cAAAA,YAAY,EAAEG,GAAG,CAACE,IAAJ,CAASL;AAFX,aAtBrB,EA0BO;AACA;;AA3BP;AAAA,mBA4BavB,KAAK,CAACmB,QAAN,CAAe,UAAf,EAA2BQ,KAA3B,CA5Bb;;AAAA;AAAA;AAAA,mBA6BoB7B,KAAK,CAACkB,cAAD,CA7BzB;;AAAA;AAAA;;AAAA;AAAA,8CA4CMJ,OAAO,CAACC,MAAR,CAAeE,GAAf,CA5CN;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAJL;;AAAA;AAAA;AAAA;AAAA;AAoDA,eAAejB,KAAf","sourcesContent":["import axios from 'axios';\r\nimport VueCookies from 'vue-cookies';\r\nimport store from '../store'\r\nimport router from '../router'\r\nimport config from '../config/config'\r\n\r\n\r\naxios.defaults.baseURL = config.baseUrl;\r\n\r\n// const instance = axios.create({\r\n//   baseURL: 'http://localhost:3000',\r\n//   timeout: 1000\r\n// });\r\n\r\n// Add a request interceptor\r\naxios.interceptors.request.use(async function (config) {\r\n    // Do something before request is sent\r\n    config.headers[\"x-access-token\"] = VueCookies.get('token');\r\n    // config.headers.refresh_token = VueCookies.get('refresh_token');\r\n  \r\n    // console.log(config);\r\n    return config;\r\n  }, function (error) {\r\n    // Do something with request error\r\n    return Promise.reject(error);\r\n  });\r\n\r\n// Add a response interceptor\r\naxios.interceptors.response.use(function (response) {\r\n    // Any status code that lie within the range of 2xx cause this function to trigger\r\n    // Do something with response data\r\n    return response;\r\n  }, async function (err) {\r\n    // Any status codes that falls outside the range of 2xx cause this function to trigger\r\n    // Do something with response error\r\n    \r\n    const originalConfig = err.config;\r\n    if (originalConfig.url !== \"/api/auth/signin\" && err.response) {\r\n      if (err.response.status == 403) {\r\n        store.dispatch(\"removeToken\");\r\n        router.push('/login');\r\n      }   \r\n      // Access Token was expired\r\n      if (err.response.status === 401 && !originalConfig.retry) {\r\n        originalConfig.retry = true;\r\n\r\n        // try {\r\n          let res = await axios.post(\"/api/auth/refreshtoken\", {\r\n            refreshToken: store.getters.getRefreshToken,\r\n          });\r\n          \r\n          // .then(async (res) => {\r\n            // const { accessToken } = res.data;\r\n            // console.log(res);\r\n            const token = {\r\n              token: res.data.accessToken,\r\n              refreshToken: res.data.refreshToken\r\n            }\r\n            // // console.log(originalConfig);\r\n            //set token info in Vuecookies\r\n            await store.dispatch('setToken', token);\r\n            return await axios(originalConfig) \r\n\r\n            // return  axios(originalConfig)\r\n            // .then((data) => {\r\n            //   store.dispatch('setUser', data.data);\r\n            // }).catch((err) => {\r\n            //   alert(err);\r\n            // });\r\n          // })\r\n          \r\n        // } catch (_error) {\r\n        //   return Promise.reject(_error);\r\n        // }\r\n      }\r\n    }\r\n    return Promise.reject(err);\r\n  });\r\n\r\n\r\nexport default axios;"]}]}
{"remainingRequest":"C:\\Users\\GreatHope\\Documents\\vue_practice\\vue_project\\second\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\GreatHope\\Documents\\vue_practice\\vue_project\\second\\node_modules\\eslint-loader\\index.js??ref--14-0!C:\\Users\\GreatHope\\Documents\\vue_practice\\vue_project\\second\\src\\service\\axios.js","dependencies":[{"path":"C:\\Users\\GreatHope\\Documents\\vue_practice\\vue_project\\second\\src\\service\\axios.js","mtime":1644805068118},{"path":"C:\\Users\\GreatHope\\Documents\\vue_practice\\vue_project\\second\\babel.config.js","mtime":1643429729254},{"path":"C:\\Users\\GreatHope\\Documents\\vue_practice\\vue_project\\second\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1643426027151},{"path":"C:\\Users\\GreatHope\\Documents\\vue_practice\\vue_project\\second\\node_modules\\babel-loader\\lib\\index.js","mtime":1643426032229},{"path":"C:\\Users\\GreatHope\\Documents\\vue_practice\\vue_project\\second\\node_modules\\eslint-loader\\index.js","mtime":1643426028315}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkM6XFxVc2Vyc1xcR3JlYXRIb3BlXFxEb2N1bWVudHNcXHZ1ZV9wcmFjdGljZVxcdnVlX3Byb2plY3RcXHNlY29uZFxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWVcXGhlbHBlcnNcXGVzbVxcYXN5bmNUb0dlbmVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZS5qcyI7CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCBWdWVDb29raWVzIGZyb20gJ3Z1ZS1jb29raWVzJzsKaW1wb3J0IHN0b3JlIGZyb20gJy4uL3N0b3JlJzsgLy8gaW1wb3J0IHsgbWFwR2V0dGVycyB9IGZyb20gJ3Z1ZXgnOwovLyBpbXBvcnQgeyByZWZyZXNoVG9rZW4gfSBmcm9tICcuLi9zZXJ2aWNlL2xvZ2luJwoKYXhpb3MuZGVmYXVsdHMuYmFzZVVSTCA9ICdodHRwOi8vbG9jYWxob3N0OjMwMDAnOyAvLyBjb25zdCBpbnN0YW5jZSA9IGF4aW9zLmNyZWF0ZSh7Ci8vICAgYmFzZVVSTDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCcsCi8vICAgdGltZW91dDogMTAwMAovLyB9KTsKLy8gQWRkIGEgcmVxdWVzdCBpbnRlcmNlcHRvcgoKYXhpb3MuaW50ZXJjZXB0b3JzLnJlcXVlc3QudXNlKCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKGNvbmZpZykgewogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAvLyBEbyBzb21ldGhpbmcgYmVmb3JlIHJlcXVlc3QgaXMgc2VudAogICAgICAgICAgICBjb25maWcuaGVhZGVyc1sieC1hY2Nlc3MtdG9rZW4iXSA9IFZ1ZUNvb2tpZXMuZ2V0KCd0b2tlbicpOyAvLyBjb25maWcuaGVhZGVycy5yZWZyZXNoX3Rva2VuID0gVnVlQ29va2llcy5nZXQoJ3JlZnJlc2hfdG9rZW4nKTsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coY29uZmlnKTsKCiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGNvbmZpZyk7CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIChfeCkgewogICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCksIGZ1bmN0aW9uIChlcnJvcikgewogIC8vIERvIHNvbWV0aGluZyB3aXRoIHJlcXVlc3QgZXJyb3IKICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwp9KTsgLy8gQWRkIGEgcmVzcG9uc2UgaW50ZXJjZXB0b3IKCmF4aW9zLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UoZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgLy8gQW55IHN0YXR1cyBjb2RlIHRoYXQgbGllIHdpdGhpbiB0aGUgcmFuZ2Ugb2YgMnh4IGNhdXNlIHRoaXMgZnVuY3Rpb24gdG8gdHJpZ2dlcgogIC8vIERvIHNvbWV0aGluZyB3aXRoIHJlc3BvbnNlIGRhdGEKICByZXR1cm4gcmVzcG9uc2U7Cn0sIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWYyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihlcnIpIHsKICAgIHZhciBvcmlnaW5hbENvbmZpZzsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIC8vIEFueSBzdGF0dXMgY29kZXMgdGhhdCBmYWxscyBvdXRzaWRlIHRoZSByYW5nZSBvZiAyeHggY2F1c2UgdGhpcyBmdW5jdGlvbiB0byB0cmlnZ2VyCiAgICAgICAgICAgIC8vIERvIHNvbWV0aGluZyB3aXRoIHJlc3BvbnNlIGVycm9yCiAgICAgICAgICAgIG9yaWdpbmFsQ29uZmlnID0gZXJyLmNvbmZpZzsKCiAgICAgICAgICAgIGlmICghKG9yaWdpbmFsQ29uZmlnLnVybCAhPT0gIi9hcGkvYXV0aC9zaWduaW4iICYmIGVyci5yZXNwb25zZSkpIHsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEyOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIShlcnIucmVzcG9uc2Uuc3RhdHVzID09PSA0MDEgJiYgIW9yaWdpbmFsQ29uZmlnLl9yZXRyeSkpIHsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEyOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBvcmlnaW5hbENvbmZpZy5fcmV0cnkgPSB0cnVlOwogICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDQ7CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNzsKICAgICAgICAgICAgcmV0dXJuIGF4aW9zLnBvc3QoIi9hcGkvYXV0aC9yZWZyZXNodG9rZW4iLCB7CiAgICAgICAgICAgICAgcmVmcmVzaFRva2VuOiBzdG9yZS5nZXR0ZXJzLmdldFJlZnJlc2hUb2tlbgogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgICAvLyBjb25zdCB7IGFjY2Vzc1Rva2VuIH0gPSByZXMuZGF0YTsKICAgICAgICAgICAgICB2YXIgdG9rZW4gPSB7CiAgICAgICAgICAgICAgICB0b2tlbjogcmVzLmFjY2Vzc1Rva2VuLAogICAgICAgICAgICAgICAgcmVmcmVzaFRva2VuOiByZXMucmVmcmVzaFRva2VuCiAgICAgICAgICAgICAgfTsgLy9zZXQgdG9rZW4gaW5mbyBpbiBWdWVjb29raWVzCgogICAgICAgICAgICAgIC8vc2V0IHRva2VuIGluZm8gaW4gVnVlY29va2llcwogICAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKCdzZXRUb2tlbicsIHRva2VuKTsKICAgICAgICAgICAgICByZXR1cm4gYXhpb3Mob3JpZ2luYWxDb25maWcpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTI7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSA5OwogICAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDJbImNhdGNoIl0oNCk7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBQcm9taXNlLnJlamVjdChfY29udGV4dDIudDApKTsKCiAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgUHJvbWlzZS5yZWplY3QoZXJyKSk7CgogICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTIsIG51bGwsIFtbNCwgOV1dKTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiAoX3gyKSB7CiAgICByZXR1cm4gX3JlZjIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCkpOwpleHBvcnQgZGVmYXVsdCBheGlvczs="},{"version":3,"sources":["C:/Users/GreatHope/Documents/vue_practice/vue_project/second/src/service/axios.js"],"names":["axios","VueCookies","store","defaults","baseURL","interceptors","request","use","config","headers","get","error","Promise","reject","response","err","originalConfig","url","status","_retry","post","refreshToken","getters","getRefreshToken","then","res","token","accessToken","dispatch"],"mappings":";;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,UAAP,MAAuB,aAAvB;AACA,OAAOC,KAAP,MAAkB,UAAlB,C,CACA;AACA;;AAGAF,KAAK,CAACG,QAAN,CAAeC,OAAf,GAAyB,uBAAzB,C,CAEA;AACA;AACA;AACA;AAEA;;AACAJ,KAAK,CAACK,YAAN,CAAmBC,OAAnB,CAA2BC,GAA3B;AAAA,qEAA+B,iBAAgBC,MAAhB;AAAA;AAAA;AAAA;AAAA;AAC3B;AACAA,YAAAA,MAAM,CAACC,OAAP,CAAe,gBAAf,IAAmCR,UAAU,CAACS,GAAX,CAAe,OAAf,CAAnC,CAF2B,CAG3B;AAEA;;AAL2B,6CAMpBF,MANoB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAA/B;;AAAA;AAAA;AAAA;AAAA,KAOK,UAAUG,KAAV,EAAiB;AAClB;AACA,SAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACD,CAVH,E,CAYA;;AACAX,KAAK,CAACK,YAAN,CAAmBS,QAAnB,CAA4BP,GAA5B,CAAgC,UAAUO,QAAV,EAAoB;AAChD;AACA;AACA,SAAOA,QAAP;AACD,CAJH;AAAA,sEAIK,kBAAgBC,GAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AACD;AACA;AACMC,YAAAA,cAHL,GAGsBD,GAAG,CAACP,MAH1B;;AAAA,kBAIGQ,cAAc,CAACC,GAAf,KAAuB,kBAAvB,IAA6CF,GAAG,CAACD,QAJpD;AAAA;AAAA;AAAA;;AAAA,kBAMKC,GAAG,CAACD,QAAJ,CAAaI,MAAb,KAAwB,GAAxB,IAA+B,CAACF,cAAc,CAACG,MANpD;AAAA;AAAA;AAAA;;AAOGH,YAAAA,cAAc,CAACG,MAAf,GAAwB,IAAxB;AAPH;AAAA;AAAA,mBAUWnB,KAAK,CAACoB,IAAN,CAAW,wBAAX,EAAqC;AACzCC,cAAAA,YAAY,EAAEnB,KAAK,CAACoB,OAAN,CAAcC;AADa,aAArC,EAEHC,IAFG,CAEE,UAACC,GAAD,EAAS;AACf;AACA,kBAAMC,KAAK,GAAG;AACZA,gBAAAA,KAAK,EAAED,GAAG,CAACE,WADC;AAEZN,gBAAAA,YAAY,EAAEI,GAAG,CAACJ;AAFN,eAAd,CAFe,CAMf;;AAAA;AACAnB,cAAAA,KAAK,CAAC0B,QAAN,CAAe,UAAf,EAA2BF,KAA3B;AAEA,qBAAO1B,KAAK,CAACgB,cAAD,CAAZ;AACD,aAZK,CAVX;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,8CAyBYJ,OAAO,CAACC,MAAR,cAzBZ;;AAAA;AAAA,8CA6BMD,OAAO,CAACC,MAAR,CAAeE,GAAf,CA7BN;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAJL;;AAAA;AAAA;AAAA;AAAA;AAqCA,eAAef,KAAf","sourcesContent":["import axios from 'axios';\r\nimport VueCookies from 'vue-cookies';\r\nimport store from '../store'\r\n// import { mapGetters } from 'vuex';\r\n// import { refreshToken } from '../service/login'\r\n\r\n\r\naxios.defaults.baseURL = 'http://localhost:3000';\r\n\r\n// const instance = axios.create({\r\n//   baseURL: 'http://localhost:3000',\r\n//   timeout: 1000\r\n// });\r\n\r\n// Add a request interceptor\r\naxios.interceptors.request.use(async function (config) {\r\n    // Do something before request is sent\r\n    config.headers[\"x-access-token\"] = VueCookies.get('token');\r\n    // config.headers.refresh_token = VueCookies.get('refresh_token');\r\n  \r\n    // console.log(config);\r\n    return config;\r\n  }, function (error) {\r\n    // Do something with request error\r\n    return Promise.reject(error);\r\n  });\r\n\r\n// Add a response interceptor\r\naxios.interceptors.response.use(function (response) {\r\n    // Any status code that lie within the range of 2xx cause this function to trigger\r\n    // Do something with response data\r\n    return response;\r\n  }, async function (err) {\r\n    // Any status codes that falls outside the range of 2xx cause this function to trigger\r\n    // Do something with response error\r\n    const originalConfig = err.config;\r\n    if (originalConfig.url !== \"/api/auth/signin\" && err.response) {\r\n      // Access Token was expired\r\n      if (err.response.status === 401 && !originalConfig._retry) {\r\n        originalConfig._retry = true;\r\n\r\n        try {\r\n          await axios.post(\"/api/auth/refreshtoken\", {\r\n            refreshToken: store.getters.getRefreshToken,\r\n          }).then((res) => {\r\n            // const { accessToken } = res.data;\r\n            const token = {\r\n              token: res.accessToken,\r\n              refreshToken: res.refreshToken\r\n            }\r\n            //set token info in Vuecookies\r\n            store.dispatch('setToken', token);\r\n\r\n            return axios(originalConfig);\r\n          })\r\n          \r\n        } catch (_error) {\r\n          return Promise.reject(_error);\r\n        }\r\n      }\r\n    }\r\n    return Promise.reject(err);\r\n  });\r\n\r\n\r\nexport default axios;"]}]}